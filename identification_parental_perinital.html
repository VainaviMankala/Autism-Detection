<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Autism Evaluation Platform</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
   <style>
      .logo-container {
         text-align: center;
         margin-bottom: 20px;
      }
      .language-selector {  
      position: absolute;  
      top: 10px;  
      right: 20px;  
    }  
      .section {
         padding: 20px;
         background-color: #f7f7f7;
         border: 1px solid #ddd;
         margin-bottom: 20px;
         border-radius: 10px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
   </style>
   <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
   <script>
      function googleTranslateElementInit() {
         new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,hi,te', // English, Hindi, Telugu
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE
         }, 'google_translate_element');
      }
   </script>
   <script type="module">
      // Firebase setup
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
      import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
  
      const firebaseConfig = {
          apiKey: "AIzaSyC_8gFPJrjBhjs4Zj5YDyYcoZQjfl6Amr0",
          authDomain: "autism-evaluation-platform.firebaseapp.com",
          projectId: "autism-evaluation-platform",
          storageBucket: "autism-evaluation-platform.appspot.com",
          messagingSenderId: "748226978662",
          appId: "1:748226978662:web:cddef872e6bfc1fb131ea7",
          measurementId: "G-1TGEHTTJF4"
      };
  
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth();
  
      // Form submission logic
      async function handleSubmit(event) {
          event.preventDefault(); // Prevent default form submission
  
          // Gather form data
          const formData = {
              identificationDetails: {
                  date: document.getElementById('date')?.value || '',
                  name: document.getElementById('name')?.value || '',
                  age: document.getElementById('age')?.value || '',
                  gender: document.getElementById('gender')?.value || '',
                  dob: document.getElementById('dob')?.value || '',
                  informant: document.getElementById('informant')?.value || '',
                  parentOccupation: document.getElementById('parent-occupation')?.value || '',
                  referral: document.getElementById('referral')?.value || '',
                  communication: document.getElementById('communication')?.value || '',
                  complaints: document.getElementById('complaints')?.value || '',
              },
              parentalDetails: {
                  marriageDetails: document.getElementById('marriageDetails')?.value || '',
                  ageOfMother: document.getElementById('ageOfMother')?.value || '',
                  mothersHealth: document.getElementById('mothersHealth')?.value || '',
                  familyIllness: document.getElementById('familyIllness')?.value || '',
                  addiction: document.getElementById('addiction')?.value || '',
                  otherDetails: document.getElementById('otherDetails')?.value || '',
              },
              prenatalDetails: {
                  antenatalCheckup: document.getElementById('antenatalCheckup')?.value || '',
                  malnutrition: document.getElementById('malnutrition')?.value || '',
                  hypoglycemia: document.getElementById('hypoglycemia')?.value || '',
                  maternalInfections: document.getElementById('maternalInfections')?.value || '',
                  maternalHypertension: document.getElementById('maternalHypertension')?.value || '',
                  injuryTrauma: document.getElementById('injuryTrauma')?.value || '',
                  drugsDuringPregnancy: document.getElementById('drugsDuringPregnancy')?.value || '',
                  otherComplaints: document.getElementById('otherComplaints')?.value || '',
              }
          };
  
          // Ensure the user is authenticated
          onAuthStateChanged(auth, async (user) => {
              if (user) {
                  try {
                      // Save each object as a separate document in Firestore
                      await setDoc(
                          doc(db, `users/${user.uid}/casehistory/identificationDetails`),
                          formData.identificationDetails
                      );
                      await setDoc(
                          doc(db, `users/${user.uid}/casehistory/parentalDetails`),
                          formData.parentalDetails
                      );
                      await setDoc(
                          doc(db, `users/${user.uid}/casehistory/prenatalDetails`),
                          formData.prenatalDetails
                      );
  
                                            // Redirect after successful submission, if needed
                      window.location.href = 'familyhistory.html'; // Update this URL as necessary
                  } catch (error) {
                      console.error("Error submitting form:", error);
                      alert("There was an error submitting the form. Please try again.");
                  }
              } else {
                  alert("User not authenticated. Please log in.");
              }
          });
      }
  
      // Attach form submission handler
      document.addEventListener("DOMContentLoaded", () => {
          const form = document.getElementById('evaluationForm');
          if (form) {
              form.addEventListener('submit', handleSubmit);
          } else {
              console.error("Form with ID 'evaluationForm' not found.");
          }
      });
  </script>
  

 
</head>
<body>
    <div class="container mt-5">
       <!-- Language Selector -->
       <div class="language-selector" id="google_translate_element"></div>
      <div class="logo-container">
         <img src="GNITS_Logo.jpeg" alt="GNITS Logo" style="max-width: 150px; margin-right: 20px;">
         <img src="Ignitio logo.jpg" alt="Ignito Logo" style="max-width: 150px;">
      </div>
      <form id="evaluationForm">
         <!-- Page 1 -->
         <div class="section">
            <h2>Identification Details</h2>
            <div class="mb-3">
               <label for="date" class="form-label">Date</label>
               <input type="date" id="date" class="form-control" required>
            </div>
            <div class="mb-3">
               <label for="name" class="form-label">Name</label>
               <input type="text" id="name" class="form-control" required>
            </div>
            <div class="mb-3">
               <label for="age" class="form-label">Age</label>
               <input type="number" id="age" class="form-control" required min="3" max="9">
               <small id="ageError" class="text-danger" style="display: none;">Age must be between 3 and 9.</small>
            
            
            <script>
               const ageInput = document.getElementById('age');
               const errorElement = document.getElementById('ageError');
            
               ageInput.addEventListener('input', () => {
                  const age = parseInt(ageInput.value, 10);
            
                  if (age < 3 || age > 9 || isNaN(age)) {
                     errorElement.style.display = 'block';
                     ageInput.value = ''; // Clear the invalid input
                  } else {
                     errorElement.style.display = 'none';
                  }
               });
            </script>
            
         </div>
            
            <div class="mb-3">
               <label for="gender" class="form-label">Gender</label>
               <select id="gender" class="form-select" required>
                  <option value="" disabled selected>Select gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
               </select>
            </div>
            <div class="mb-3">
               <label for="dob" class="form-label">Date of Birth</label>
               <input type="date" id="dob" class="form-control" required>
            </div>
            <div class="mb-3">
               <label for="informant" class="form-label">Informant</label>
               <input type="text" id="informant" class="form-control" required>
            </div>
            <div class="mb-3">
               <label for="parent-occupation" class="form-label">Parent's Occupation</label>
               <input type="text" id="parent-occupation" class="form-control" required>
            </div>
            <div class="mb-3">
               <label for="referral" class="form-label">Referral</label>
               <input type="text" id="referral" class="form-control" required>
            </div>
            <div class="mb-3">
               <label for="communication" class="form-label">Communication</label>
               <select id="communication" class="form-select" required>
                  <option value="" disabled selected>Select communication</option>
                  <option value="verbal">Verbal</option>
                  <option value="nonverbal">Nonverbal</option>
                  <option value="differential-crying">Differential Crying</option>
               </select>
               <fieldset class="mb-4">
                <legend>Presenting Chief Complaints</legend>
                <div class="mb-3">
                    <textarea id="complaints" class="form-control" rows="5" required></textarea>
                </div>
            </fieldset>
            </div>
            <!-- Inputs -->
         </div>

         <!-- Page 2 -->
         <div class="section">
            <h2>Parental Details</h2>
            <div class="mb-3">
               <label for="marriageDetails" class="form-label">Details of Marriage (Consanguineous/Non Consanguineous)</label>
               <input type="text" class="form-control" id="marriageDetails" placeholder="Enter details of marriage" required>
           </div>
           <div class="mb-3">
               <label for="ageOfMother" class="form-label">Age of Mother During Delivery</label>
               <input type="number" class="form-control" id="ageOfMother" placeholder="Enter age of mother" required>
           </div>
           <div class="mb-3">
               <label for="mothersHealth" class="form-label">History of Mother's Health During Pregnancy</label>
               <textarea class="form-control" id="mothersHealth" rows="3" placeholder="Enter health details" required></textarea>
           </div>
           <div class="mb-3">
               <label for="familyIllness" class="form-label">Family Illness History (Neuromuscular Diseases, Mental Illness, Convulsions)</label>
               <textarea class="form-control" id="familyIllness" rows="3" placeholder="Enter family illness history" required></textarea>
           </div>
           <div class="mb-3">
               <label for="addiction" class="form-label">Any Addiction</label>
               <input type="text" class="form-control" id="addiction" placeholder="Enter addiction details">
           </div>
           <div class="mb-3">
               <label for="otherDetails" class="form-label">Any Other Relevant Details</label>
               <textarea class="form-control" id="otherDetails" rows="3" placeholder="Enter other relevant details"></textarea>
           </div>
            <!-- Inputs -->
         </div>

         <!-- Page 3 -->
         <div class="section">
            <h2>Prenatal Details</h2>
            <div class="mb-3">
               <label for="antenatalCheckup" class="form-label">Antenatal check-up</label>
               <textarea class="form-control" id="antenatalCheckup" rows="3" placeholder="Enter antenatal check-up details" required></textarea>
           </div>
           <div class="mb-3">
               <label for="malnutrition" class="form-label">Malnutrition</label>
               <input type="text" class="form-control" id="malnutrition" placeholder="Enter malnutrition details" required>
           </div>
           <div class="mb-3">
               <label for="hypoglycemia" class="form-label">Hypoglycemia</label>
               <input type="text" class="form-control" id="hypoglycemia" placeholder="Enter hypoglycemia details" required>
           </div>
           <div class="mb-3">
               <label for="maternalInfections" class="form-label">Maternal infections</label>
               <input type="text" class="form-control" id="maternalInfections" placeholder="Enter maternal infections" required>
           </div>
           <div class="mb-3">
               <label for="maternalHypertension" class="form-label">Maternal hypertension</label>
               <input type="text" class="form-control" id="maternalHypertension" placeholder="Enter maternal hypertension details" required>
           </div>
           <div class="mb-3">
               <label for="injuryTrauma" class="form-label">Injury/Trauma/Stress</label>
               <textarea class="form-control" id="injuryTrauma" rows="3" placeholder="Enter injury/trauma/stress details" required></textarea>
           </div>
           <div class="mb-3">
               <label for="drugsDuringPregnancy" class="form-label">Any drugs taken during pregnancy</label>
               <textarea class="form-control" id="drugsDuringPregnancy" rows="3" placeholder="Enter drugs taken during pregnancy" required></textarea>
           </div>
           <div class="mb-3">
               <label for="otherComplaints" class="form-label">Any other complaints</label>
               <textarea class="form-control" id="otherComplaints" rows="3" placeholder="Enter other complaints"></textarea>
           </div>
            <!-- Inputs -->
         </div>

         <div class="text-end">
            <button type="button" class="btn btn-primary" onclick="window.location.href='educational_family_play.html';">Next</button>
         </div>
      </form>
   </div>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>