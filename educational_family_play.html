<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Educational Page</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
   <style>
      .logo-container {
         text-align: center;
         margin-bottom: 20px;
      }
      .language-selector {
         position: absolute;
         top: 10px;
         right: 20px;
      }
      .section {
         padding: 20px;
         background-color: #f7f7f7;
         border: 1px solid #ddd;
         margin-bottom: 20px;
         border-radius: 10px;
         box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
   </style>
   <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
   <script>
      function googleTranslateElementInit() {
         new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,hi,te', // English, Hindi, Telugu
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE
         }, 'google_translate_element');
      }
   </script>
   <script type="module">
      // Firebase setup
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
      import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

      const firebaseConfig = {
         apiKey: "AIzaSyC_8gFPJrjBhjs4Zj5YDyYcoZQjfl6Amr0",
         authDomain: "autism-evaluation-platform.firebaseapp.com",
         projectId: "autism-evaluation-platform",
         storageBucket: "autism-evaluation-platform.appspot.com",
         messagingSenderId: "748226978662",
         appId: "1:748226978662:web:cddef872e6bfc1fb131ea7",
         measurementId: "G-1TGEHTTJF4"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth();

      // Form submission logic
      async function handleSubmit(event) {
         event.preventDefault(); // Prevent default form submission

         // Gather form data
         const formData = {
            educationalHistory: {
               schoolAge: document.getElementById('schoolAge')?.value || '',
               peerTeacherRelationship: document.getElementById('peerTeacherRelationship')?.value || '',
               schoolIssues: document.getElementById('schoolIssues')?.value || '',
               anyOtherEducational: document.getElementById('anyOtherEducational')?.value || '',
            },
            familyHistory: {
               siblingHistory: document.getElementById('siblingHistory')?.value || '',
               consanguinity: document.getElementById('consanguinity')?.value || '',
               anyOthers: document.getElementById('anyOthers')?.value || '',
            },
            playAndDevelopmentalHistory: {
               playingHistory: document.getElementById('playinghistory')?.value || '',
               motorDevelopment: document.getElementById('motordev')?.value || '',
               sensoryDevelopment: document.getElementById('sensorydev')?.value || '',
               speechDevelopment: document.getElementById('speechdev')?.value || '',
               socialDevelopment: document.getElementById('socialdev')?.value || '',
            }
         };

         // Ensure the user is authenticated
         onAuthStateChanged(auth, async (user) => {
            if (user) {
               try {
                  // Save each object as a separate document in Firestore
                  await setDoc(
                     doc(db, `users/${user.uid}/casehistory/educationalHistory`),
                     formData.educationalHistory
                  );
                  await setDoc(
                     doc(db, `users/${user.uid}/casehistory/familyHistory`),
                     formData.familyHistory
                  );
                  await setDoc(
                     doc(db, `users/${user.uid}/casehistory/playAndDevelopmentalHistory`),
                     formData.playAndDevelopmentalHistory
                  );

                  // Redirect after successful submission, if needed
                  window.location.href = 'Behaviouralnew.html'; // Update this URL as necessary
               } catch (error) {
                  console.error("Error submitting form:", error);
                  alert("There was an error submitting the form. Please try again.");
               }
            } else {
               alert("User not authenticated. Please log in.");
            }
         });
      }

      // Attach form submission handler
      document.addEventListener("DOMContentLoaded", () => {
         const form = document.getElementById('evaluationForm');
         if (form) {
            form.addEventListener('submit', handleSubmit);
         } else {
            console.error("Form with ID 'evaluationForm' not found.");
         }
      });
   </script>
</head>
<body>
   <!-- Language Selector -->
   <div class="language-selector" id="google_translate_element"></div>

   <!-- Logo Section -->
   <div class="logo-container">
      <img src="GNITS_Logo.jpeg" alt="GNITS Logo" style="max-width: 150px; margin-right: 20px;">
      <img src="Ignitio logo.jpg" alt="Ignito Logo" style="max-width: 150px;">
   </div>

   <!-- Form Content -->
   <div class="container mt-5">
      <form id="evaluationForm">
         <!-- Page 1: Educational History -->
         <div class="section">
            <h2>Educational History</h2>
            <div class="mb-3">
               <label for="schoolAge" class="form-label">Age of beginning of school</label>
               <input type="number" class="form-control" id="schoolAge" placeholder="Enter the age when schooling began">
            </div>
            <div class="mb-3">
               <label for="peerTeacherRelationship" class="form-label">Relationship between peers and teachers</label>
               <textarea class="form-control" id="peerTeacherRelationship" rows="3" placeholder="Describe the relationship with peers and teachers"></textarea>
            </div>
            <div class="mb-3">
               <label for="schoolIssues" class="form-label">Any school phobia, non-attendance, truancy, or reading/writing difficulties</label>
               <textarea class="form-control" id="schoolIssues" rows="3" placeholder="Detail any school issues"></textarea>
            </div>
            <div class="mb-3">
               <label for="anyOtherEducational" class="form-label">Any other educational issues</label>
               <textarea class="form-control" id="anyOtherEducational" rows="3" placeholder="Enter any other educational issues"></textarea>
            </div>
         </div>

         <!-- Page 2: Family History -->
         <div class="section">
            <h2>Family History</h2>
            <div class="mb-3">
               <label for="siblingHistory" class="form-label">Sibling history</label>
               <textarea class="form-control" id="siblingHistory" rows="3" placeholder="Enter sibling history details"></textarea>
            </div>
            <div class="mb-3">
               <label for="consanguinity" class="form-label">Consanguinity</label>
               <textarea class="form-control" id="consanguinity" rows="3" placeholder="Enter details about consanguinity"></textarea>
            </div>
            <div class="mb-3">
               <label for="anyOthers" class="form-label">Any others</label>
               <textarea class="form-control" id="anyOthers" rows="3" placeholder="Enter any other relevant family history"></textarea>
            </div>
         </div>

         <!-- Page 3: Play and Developmental History -->
         <div class="section">
            <h2>Play and Developmental History</h2>
            <div class="mb-3">
               <label for="playinghistory" class="form-label">Play History of the Child</label>
               <textarea class="form-control" id="playinghistory" rows="3" placeholder="Enter the play history of the child"></textarea>
            </div>
            <h3>Developmental History</h3>
            <div class="mb-3">
               <label for="motordev" class="form-label">Motor Development</label>
               <textarea class="form-control" id="motordev" rows="1" placeholder=""></textarea>
            </div>
            <div class="mb-3">
               <label for="sensorydev" class="form-label">Sensory Development</label>
               <textarea class="form-control" id="sensorydev" rows="1" placeholder=""></textarea>
            </div>
            <div class="mb-3">
               <label for="speechdev" class="form-label">Speech and Language Development</label>
               <textarea class="form-control" id="speechdev" rows="1" placeholder=""></textarea>
            </div>
            <div class="mb-3">
               <label for="socialdev" class="form-label">Social Development</label>
               <textarea class="form-control" id="socialdev" rows="1" placeholder=""></textarea>
            </div>
         </div>

         <button type="button" class="btn btn-primary" onclick="window.location.href='perinital_postnatal_treatment.html';">Next</button>
      </form>
   </div>
</body>
</html>
